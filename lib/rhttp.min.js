/*!
 * @overview RSVP - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/tildeio/rsvp.js/master/LICENSE
 * @version   3.0.18
 */

(function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function n(t){return"function"==typeof t}function r(t){return"object"==typeof t&&null!==t}function e(){}function o(t,n){for(var r=0,e=t.length;r<e;r++)if(t[r]===n)return r;return-1}function i(t){var n=t._promiseCallbacks;return n||(n=t._promiseCallbacks={}),n}function u(t,n){return"onerror"===t?void yt.on("error",n):2!==arguments.length?yt[t]:void(yt[t]=n)}function c(){setTimeout(function(){for(var t,n=0;n<mt.length;n++){t=mt[n];var r=t.payload;r.guid=r.key+r.id,r.childGuid=r.key+r.childId,r.error&&(r.stack=r.error.stack),yt.trigger(t.name,t.payload)}mt.length=0},50)}function s(t,n,r){1===mt.push({name:t,payload:{key:n._guidKey,id:n._id,eventName:t,detail:n._result,childId:r&&r._id,label:n._label,timeStamp:ht(),error:yt["instrument-with-stack"]?new Error(n._label):null}})&&c()}function a(){return new TypeError("A promises callback cannot return that same promise.")}function f(){}function l(t){try{return t.then}catch(t){return Tt.error=t,Tt}}function p(t,n,r,e){try{t.call(n,r,e)}catch(t){return t}}function d(t,n,r){yt.async(function(t){var e=!1,o=p(r,n,function(r){e||(e=!0,n!==r?_(t,r):m(t,r))},function(n){e||(e=!0,w(t,n))},"Settle: "+(t._label||" unknown promise"));!e&&o&&(e=!0,w(t,o))},t)}function h(t,n){n._state===bt?m(t,n._result):n._state===Et?(n._onError=null,w(t,n._result)):g(n,void 0,function(r){n!==r?_(t,r):m(t,r)},function(n){w(t,n)})}function v(t,r){if(r.constructor===t.constructor)h(t,r);else{var e=l(r);e===Tt?w(t,Tt.error):void 0===e?m(t,r):n(e)?d(t,r,e):m(t,r)}}function _(n,r){n===r?m(n,r):t(r)?v(n,r):m(n,r)}function y(t){t._onError&&t._onError(t._result),b(t)}function m(t,n){t._state===gt&&(t._result=n,t._state=bt,0===t._subscribers.length?yt.instrument&&wt("fulfilled",t):yt.async(b,t))}function w(t,n){t._state===gt&&(t._state=Et,t._result=n,yt.async(y,t))}function g(t,n,r,e){var o=t._subscribers,i=o.length;t._onError=null,o[i]=n,o[i+bt]=r,o[i+Et]=e,0===i&&t._state&&yt.async(b,t)}function b(t){var n=t._subscribers,r=t._state;if(yt.instrument&&wt(r===bt?"fulfilled":"rejected",t),0!==n.length){for(var e,o,i=t._result,u=0;u<n.length;u+=3)e=n[u],o=n[u+r],e?A(r,e,o,i):o(i);t._subscribers.length=0}}function E(){this.error=null}function T(t,n){try{return t(n)}catch(t){return At.error=t,At}}function A(t,r,e,o){var i,u,c,s,f=n(e);if(f){if(i=T(e,o),i===At?(s=!0,u=i.error,i=null):c=!0,r===i)return void w(r,a())}else i=o,c=!0;r._state!==gt||(f&&c?_(r,i):s?w(r,u):t===bt?m(r,i):t===Et&&w(r,i))}function j(t,n){var r=!1;try{n(function(n){r||(r=!0,_(t,n))},function(n){r||(r=!0,w(t,n))})}catch(n){w(t,n)}}function P(t,n,r){return t===bt?{state:"fulfilled",value:r}:{state:"rejected",reason:r}}function C(t,n,r,e){var o=this;o._instanceConstructor=t,o.promise=new t(f,e),o._abortOnReject=r,o._validateInput(n)?(o._input=n,o.length=n.length,o._remaining=n.length,o._init(),0===o.length?m(o.promise,o._result):(o.length=o.length||0,o._enumerate(),0===o._remaining&&m(o.promise,o._result))):w(o.promise,o._validationError())}function S(t,n){return new jt(this,t,!0,n).promise}function x(t,n){function r(t){_(i,t)}function e(t){w(i,t)}var o=this,i=new o(f,n);if(!dt(t))return w(i,new TypeError("You must pass an array to race.")),i;for(var u=t.length,c=0;i._state===gt&&c<u;c++)g(o.resolve(t[c]),void 0,r,e);return i}function k(t,n){var r=this;if(t&&"object"==typeof t&&t.constructor===r)return t;var e=new r(f,n);return _(e,t),e}function O(t,n){var r=this,e=new r(f,n);return w(e,t),e}function R(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function I(t,r){var e=this;e._id=Ot++,e._label=r,e._state=void 0,e._result=void 0,e._subscribers=[],yt.instrument&&wt("created",e),f!==t&&(n(t)||R(),e instanceof I||F(),j(e,t))}function M(t,n,r){this._superConstructor(t,n,!1,r)}function N(t,n){return new M(Rt,t,n).promise}function H(t,n){return Rt.all(t,n)}function q(t,n){Jt[Ht]=t,Jt[Ht+1]=n,2===(Ht+=2)&&It()}function D(){return function(){Ft(G)}}function Y(){return function(){setTimeout(G,1)}}function G(){for(var t=0;t<Ht;t+=2){(0,Jt[t])(Jt[t+1]),Jt[t]=void 0,Jt[t+1]=void 0}Ht=0}function K(t){var n={};return n.promise=new Rt(function(t,r){n.resolve=t,n.reject=r},t),n}function U(t,r,e){return Rt.all(t,e).then(function(t){if(!n(r))throw new TypeError("You must pass a function as filter's second argument.");for(var o=t.length,i=new Array(o),u=0;u<o;u++)i[u]=r(t[u]);return Rt.all(i,e).then(function(n){for(var r=new Array(o),e=0,i=0;i<o;i++)n[i]&&(r[e]=t[i],e++);return r.length=e,r})})}function J(t,n,r){this._superConstructor(t,n,!0,r)}function L(t,n,r){this._superConstructor(t,n,!1,r)}function B(t,n){return new L(Rt,t,n).promise}function V(t,n){return new Vt(Rt,t,n).promise}function W(t,r,e){return Rt.all(t,e).then(function(t){if(!n(r))throw new TypeError("You must pass a function as map's second argument.");for(var o=t.length,i=new Array(o),u=0;u<o;u++)i[u]=r(t[u]);return Rt.all(i,e)})}function $(){this.value=void 0}function z(t){try{return t.then}catch(t){return Xt.value=t,Xt}}function Q(t,n,r){try{t.apply(n,r)}catch(t){return Xt.value=t,Xt}}function X(t,n){for(var r,e,o={},i=t.length,u=new Array(i),c=0;c<i;c++)u[c]=t[c];for(e=0;e<n.length;e++)r=n[e],o[r]=u[e+1];return o}function Z(t){for(var n=t.length,r=new Array(n-1),e=1;e<n;e++)r[e-1]=t[e];return r}function tt(t,n){return{then:function(r,e){return t.call(n,r,e)}}}function nt(t,n){var r=function(){for(var r,e=this,o=arguments.length,i=new Array(o+1),u=!1,c=0;c<o;++c){if(r=arguments[c],!u){if((u=ot(r))===Zt){var s=new Rt(f);return w(s,Zt.value),s}u&&!0!==u&&(r=tt(u,r))}i[c]=r}var a=new Rt(f);return i[o]=function(t,r){t?w(a,t):void 0===n?_(a,r):!0===n?_(a,Z(arguments)):dt(n)?_(a,X(arguments,n)):_(a,r)},u?et(a,i,t,e):rt(a,i,t,e)};return r.__proto__=t,r}function rt(t,n,r,e){var o=Q(r,e,n);return o===Xt&&w(t,o.value),t}function et(t,n,r,e){return Rt.all(n).then(function(n){var o=Q(r,e,n);return o===Xt&&w(t,o.value),t})}function ot(t){return!(!t||"object"!=typeof t)&&(t.constructor===Rt||z(t))}function it(t,n){return Rt.race(t,n)}function ut(t,n){return Rt.reject(t,n)}function ct(t,n){return Rt.resolve(t,n)}function st(t){throw setTimeout(function(){throw t}),t}function at(t,n){yt.async(t,n)}function ft(){yt.on.apply(yt,arguments)}function lt(){yt.off.apply(yt,arguments)}var pt;pt=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var dt=pt,ht=Date.now||function(){return(new Date).getTime()},vt=Object.create||function(t){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof t)throw new TypeError("Argument must be an object");return e.prototype=t,new e},_t={mixin:function(t){return t.on=this.on,t.off=this.off,t.trigger=this.trigger,t._promiseCallbacks=void 0,t},on:function(t,n){var r,e=i(this);r=e[t],r||(r=e[t]=[]),-1===o(r,n)&&r.push(n)},off:function(t,n){var r,e,u=i(this);if(!n)return void(u[t]=[]);r=u[t],-1!==(e=o(r,n))&&r.splice(e,1)},trigger:function(t,n){var r,e=i(this);if(r=e[t])for(var o=0;o<r.length;o++)(0,r[o])(n)}},yt={instrument:!1};_t.mixin(yt);var mt=[],wt=s,gt=void 0,bt=1,Et=2,Tt=new E,At=new E,jt=C;C.prototype._validateInput=function(t){return dt(t)},C.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},C.prototype._init=function(){this._result=new Array(this.length)},C.prototype._enumerate=function(){for(var t=this,n=t.length,r=t.promise,e=t._input,o=0;r._state===gt&&o<n;o++)t._eachEntry(e[o],o)},C.prototype._eachEntry=function(t,n){var e=this,o=e._instanceConstructor;r(t)?t.constructor===o&&t._state!==gt?(t._onError=null,e._settledAt(t._state,n,t._result)):e._willSettleAt(o.resolve(t),n):(e._remaining--,e._result[n]=e._makeResult(bt,n,t))},C.prototype._settledAt=function(t,n,r){var e=this,o=e.promise;o._state===gt&&(e._remaining--,e._abortOnReject&&t===Et?w(o,r):e._result[n]=e._makeResult(t,n,r)),0===e._remaining&&m(o,e._result)},C.prototype._makeResult=function(t,n,r){return r},C.prototype._willSettleAt=function(t,n){var r=this;g(t,void 0,function(t){r._settledAt(bt,n,t)},function(t){r._settledAt(Et,n,t)})};var Pt=S,Ct=x,St=k,xt=O,kt="rsvp_"+ht()+"-",Ot=0,Rt=I;I.cast=St,I.all=Pt,I.race=Ct,I.resolve=St,I.reject=xt,I.prototype={constructor:I,_guidKey:kt,_onError:function(t){yt.async(function(n){setTimeout(function(){n._onError&&yt.trigger("error",t)},0)},this)},then:function(t,n,r){var e=this,o=e._state;if(o===bt&&!t||o===Et&&!n)return yt.instrument&&wt("chained",e,e),e;e._onError=null;var i=new e.constructor(f,r),u=e._result;if(yt.instrument&&wt("chained",e,i),o){var c=arguments[o-1];yt.async(function(){A(o,i,c,u)})}else g(e,i,t,n);return i},catch:function(t,n){return this.then(void 0,t,n)},finally:function(t,n){var r=this,e=r.constructor;return r.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){throw n})},n)}},M.prototype=vt(jt.prototype),M.prototype._superConstructor=jt,M.prototype._makeResult=P,M.prototype._validationError=function(){return new Error("allSettled must be called with an array")};var Ft,It,Mt=N,Nt=H,Ht=0,qt=q,Dt="undefined"!=typeof window?window:void 0,Yt=Dt||{},Gt=Yt.MutationObserver||Yt.WebKitMutationObserver,Kt="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Ut="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Jt=new Array(1e3);It=Kt?function(){var t=process.nextTick,n=process.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/);return Array.isArray(n)&&"0"===n[1]&&"10"===n[2]&&(t=setImmediate),function(){t(G)}}():Gt?function(){var t=0,n=new Gt(G),r=document.createTextNode("");return n.observe(r,{characterData:!0}),function(){r.data=t=++t%2}}():Ut?function(){var t=new MessageChannel;return t.port1.onmessage=G,function(){t.port2.postMessage(0)}}():void 0===Dt&&"function"==typeof require?function(){try{var t=require,n=t("vertx");return Ft=n.runOnLoop||n.runOnContext,D()}catch(t){return Y()}}():Y();var Lt=K,Bt=U,Vt=J;J.prototype=vt(jt.prototype),J.prototype._superConstructor=jt,J.prototype._init=function(){this._result={}},J.prototype._validateInput=function(t){return t&&"object"==typeof t},J.prototype._validationError=function(){return new Error("Promise.hash must be called with an object")},J.prototype._enumerate=function(){var t=this,n=t.promise,r=t._input,e=[];for(var o in r)n._state===gt&&Object.prototype.hasOwnProperty.call(r,o)&&e.push({position:o,entry:r[o]});var i=e.length;t._remaining=i;for(var u,c=0;n._state===gt&&c<i;c++)u=e[c],t._eachEntry(u.entry,u.position)},L.prototype=vt(Vt.prototype),L.prototype._superConstructor=jt,L.prototype._makeResult=P,L.prototype._validationError=function(){return new Error("hashSettled must be called with an object")};var Wt,$t=B,zt=V,Qt=W,Xt=new $,Zt=new $,tn=nt;if("object"==typeof self)Wt=self;else{if("object"!=typeof global)throw new Error("no global: `self` or `global` found");Wt=global}var nn=Wt,rn=it,en=ut,on=ct,un=st;yt.async=qt;if("undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var cn=window.__PROMISE_INSTRUMENTATION__;u("instrument",!0);for(var sn in cn)cn.hasOwnProperty(sn)&&ft(sn,cn[sn])}var an={race:rn,Promise:Rt,allSettled:Mt,hash:zt,hashSettled:$t,denodeify:tn,on:ft,off:lt,map:Qt,filter:Bt,resolve:on,reject:en,all:Nt,rethrow:un,defer:Lt,EventTarget:_t,configure:u,async:at};"function"==typeof define&&define.amd?define("rsvp",[],function(){return an}):"undefined"!=typeof module&&module.exports?module.exports=an:void 0!==nn&&(nn.RSVP=an)}).call(this),define("Functions/log",[],function(){return function(t,n){void 0===n&&(n=!0),!0===n&&console.log(t)}}),define("Functions/xGetHTTP",["rsvp","request","Functions/log"],function(t,n,r){return function(r){return new t.Promise(function(t,e){n.get(r,function(n,r,o){n||200!==r.statusCode?e({Error:n,Response:r}):t(o)})})}}),define("Functions/xPostHTTP",["rsvp","request"],function(t,n){return function(r){return new t.Promise(function(t,e){n.post(r,function(n,r,o){n||200!==r.statusCode?e({Error:n,Response:r}):t(o)})})}}),define("Functions/xPutHTTP",["rsvp","request","Functions/log"],function(t,n,r){return function(e){return new t.Promise(function(t,o){n.put(e,function(n,e,i){r("Error: "+JSON.stringify(n),!1),r("StatusCode: "+e.statusCode,!1),r("Body: "+i,!1),n||200!==e.statusCode?o({Error:n,Response:e}):t(i)})})}}),define("Functions/xDeleteHTTP",["rsvp","request","Functions/log"],function(t,n,r){return function(r){return new t.Promise(function(t,e){n.del(r,function(n,r,o){n||200!==r.statusCode?e({Error:n,Response:r}):t(o)})})}}),define("http",["Functions/xGetHTTP","Functions/xPostHTTP","Functions/xPutHTTP","Functions/xDeleteHTTP"],function(t,n,r,e){return{get:t,post:n,put:r,delete:e}}),define("rhttp",["vm","requirejs","http"],function(t,n,r){return{load:function(e,o,i,u){var c=n.s.contexts._;r.get(e).then(function(r){t.createContext(n),t.runInContext(r,n),c.completeLoad(e);var o=c.registry[e];o.enable(),o.check(),i(c.defined[e])}).catch(function(t){setTimeout(function(){i.error(JSON.stringify(t))})})}}});